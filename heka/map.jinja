{%- load_yaml as server_defaults %}
Debian:
  pkgs:
  - acl
  - heka
  user:
  - heka
  groups:
  - adm
  - syslog
  service:
  - heka
  filter: {}
  splitter: {}
  encoder: {}
  decoder: {}
  extra_fields:
    environment_label: {{ grains.domain }}
  {%- if pillar.get('linux', {}).get('system', {}).timezone is defined %}
  timezone: "{{ pillar.linux.system.timezone }}"
  {%- endif %}
RedHat:
  groups:
  - adm
  service:
  - heka
  pkgs:
  - acl
  - heka
{%- endload %}
{%- set server = salt['grains.filter_by'](server_defaults, merge=salt['pillar.get']('heka:server')) %}

{%- load_yaml as elasticsearch_defaults %}
default:
  elasticsearch_port: 9200
{%- endload %}
{% set log_collector = salt['grains.filter_by'](elasticsearch_defaults, merge=salt['pillar.get']('heka:log_collector')) %}

{%- load_yaml as influxdb_defaults %}
default:
  influxdb_port: 8086
  influxdb_time_precision: ms
  influxdb_timeout: 5000
{%- endload %}

{%- load_yaml as metric_collector_defaults %}
default:
  aggregator_port: 5565
{%- endload %}
{% set metric_collector = salt['grains.filter_by'](
    metric_collector_defaults,
    merge=salt['grains.filter_by'](
        influxdb_defaults,
        merge=salt['pillar.get']('heka:metric_collector'))) %}

{% set remote_collector = salt['grains.filter_by'](influxdb_defaults, merge=salt['pillar.get']('heka:remote_collector')) %}
{% set aggregator = salt['grains.filter_by'](influxdb_defaults, merge=salt['pillar.get']('heka:aggregator')) %}
