applications:
- heka
_param:
parameters:
  heka:
    server:
      enabled: true
      input:
        rabbitmq:
          engine: amqp
          host: ${_param:heka_router_input_host}
          user: ${_param:heka_router_input_user}
          password: ${_param:heka_router_input_password}
          vhost: ${_param:heka_router_input_vhost}
          port: 5672
          exchange: ${_param:heka_router_input_exchange}
          exchange_type: fanout
          decoder: ProtoBufDecoder
          splitter: HekaFramingSplitter
        rsyslog_syslog:
          engine: logstreamer
          log_directory: /var/log
          file_match: syslog\.?(?P<Index>\d+)?(.gz)?
          decoder: RsyslogDecoder
          priority: ["^Index"]
        rsyslog_auth:
          engine: logstreamer
          log_directory: /var/log
          file_match: auth\.log\.?(?P<Index>\d+)?(.gz)?
          decoder: RsyslogDecoder
          priority: ["^Index"]
      decoder:
        rsyslog:
          engine: rsyslog
          template: \%TIMESTAMP\% \%HOSTNAME\% \%syslogtag\%\%msg:::sp-if-no-1st-sp\%\%msg:::drop-last-lf\%\n
          hostname_keep: TRUE
          tz: Europe/Prague
        ProtoBufDecoder:
          engine: protobuf
      output:
        elasticsearch01:
          engine: elasticsearch
          host: ${_param:heka_router_output_host}
          port: 9200
          encoder: es_json
          message_matcher: "TRUE"
        dashboard01:
          engine: dashboard
          ticker_interval: 30
      encoder:
        es_json:
          engine: es-json
          index: logfile-%{%Y.%m.%d}
          es_index_from_timestamp: true

